import{a as ie,g as me,d as ce,u as fe,c as ye}from"./role-DKO9rRKm.js";import{l as _e}from"./menu-BHtc4xvt.js";import{l as ge}from"./dept-BHWUl4rM.js";import{x as be,d as m,f as $,c as ve,b as l,y as N,w as t,r as s,z as A,m as k,o as _,a as S,h as p,t as h,p as ke,A as Q,s as Ve,E as z}from"./index-BDk5bd72.js";const we={class:"page-card"},Ne={class:"tree-border"},Se={class:"tree-border"},he={__name:"index",setup(xe){const x=m(!1),D=m([]),U=m(0),f=m(!1),C=m(""),I=m(!1),T=m([]),E=m([]),B=m(),V=m(),w=m(),d=$({pageNum:1,pageSize:10,roleName:"",roleKey:""}),o=$({roleId:null,roleName:"",roleKey:"",dataScope:"1",sort:0,status:"0",remark:"",menuIds:[],deptIds:[]}),F={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleKey:[{required:!0,message:"请输入权限字符",trigger:"blur"}]},L={1:{label:"全部数据",type:"primary"},2:{label:"自定义数据",type:"warning"},3:{label:"本部门及以下",type:"success"},4:{label:"仅本部门",type:"info"},5:{label:"仅本人",type:"danger"}},G=n=>{var e;return((e=L[n])==null?void 0:e.label)||"未知"},H=n=>{var e;return((e=L[n])==null?void 0:e.type)||""};be(()=>{y(),J(),W()});const y=async()=>{x.value=!0;try{const n=await ie(d);D.value=n.data.rows||[],U.value=n.data.total||0}finally{x.value=!1}},J=async()=>{const n=await _e();T.value=n.data||[]},W=async()=>{const n=await ge();E.value=n.data||[]},M=()=>{d.pageNum=1,y()},X=()=>{d.roleName="",d.roleKey="",M()},O=()=>{o.roleId=null,o.roleName="",o.roleKey="",o.dataScope="1",o.sort=0,o.status="0",o.remark="",o.menuIds=[],o.deptIds=[]},Y=()=>{O(),C.value="新增角色",f.value=!0,Q(()=>{var n,e;(n=V.value)==null||n.setCheckedKeys([]),(e=w.value)==null||e.setCheckedKeys([])})},Z=async n=>{O();const e=await me(n.roleId),r=e.data.role,u=e.data.menuIds||[],c=e.data.deptIds||[];Object.assign(o,{roleId:r.roleId,roleName:r.roleName,roleKey:r.roleKey,dataScope:r.dataScope,sort:r.sort,status:r.status,remark:r.remark}),C.value="编辑角色",f.value=!0,Q(()=>{var g,i;(g=V.value)==null||g.setCheckedKeys(u),(i=w.value)==null||i.setCheckedKeys(c)})},ee=async()=>{var n,e;await B.value.validate(),o.menuIds=((n=V.value)==null?void 0:n.getCheckedKeys())||[],o.deptIds=((e=w.value)==null?void 0:e.getCheckedKeys())||[],I.value=!0;try{o.roleId?(await fe(o.roleId,o),z.success("更新成功")):(await ye(o),z.success("创建成功")),f.value=!1,y()}finally{I.value=!1}},le=n=>{Ve.confirm("确定删除该角色吗？","提示",{type:"warning"}).then(async()=>{await ce(n.roleId),z.success("删除成功"),y()})},te=n=>n?new Date(n).toLocaleString("zh-CN"):"-";return(n,e)=>{const r=s("el-input"),u=s("el-form-item"),c=s("el-button"),g=s("el-form"),i=s("el-table-column"),j=s("el-tag"),ae=s("el-table"),oe=s("el-pagination"),b=s("el-col"),K=s("el-row"),ne=s("el-input-number"),q=s("el-radio"),se=s("el-radio-group"),v=s("el-option"),de=s("el-select"),P=s("el-tree"),re=s("el-dialog"),R=A("permission"),ue=A("loading");return _(),ve("div",we,[l(g,{inline:!0,model:d,class:"table-actions"},{default:t(()=>[S("div",null,[l(u,{label:"角色名称"},{default:t(()=>[l(r,{modelValue:d.roleName,"onUpdate:modelValue":e[0]||(e[0]=a=>d.roleName=a),placeholder:"请输入角色名称",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"权限字符"},{default:t(()=>[l(r,{modelValue:d.roleKey,"onUpdate:modelValue":e[1]||(e[1]=a=>d.roleKey=a),placeholder:"请输入权限字符",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(c,{type:"primary",icon:"Search",onClick:M},{default:t(()=>[...e[12]||(e[12]=[p("搜索",-1)])]),_:1}),l(c,{icon:"Refresh",onClick:X},{default:t(()=>[...e[13]||(e[13]=[p("重置",-1)])]),_:1})]),_:1})]),S("div",null,[N((_(),k(c,{type:"primary",icon:"Plus",onClick:Y},{default:t(()=>[...e[14]||(e[14]=[p("新增",-1)])]),_:1})),[[R,"system:role:add"]])])]),_:1},8,["model"]),N((_(),k(ae,{data:D.value,border:""},{default:t(()=>[l(i,{type:"index",label:"序号",width:"60",align:"center"}),l(i,{prop:"roleName",label:"角色名称",width:"150"}),l(i,{prop:"roleKey",label:"权限字符",width:"150"}),l(i,{prop:"dataScope",label:"数据范围",width:"150"},{default:t(({row:a})=>[l(j,{type:H(a.dataScope)},{default:t(()=>[p(h(G(a.dataScope)),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"sort",label:"排序",width:"80",align:"center"}),l(i,{prop:"status",label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[l(j,{type:a.status==="0"?"success":"danger"},{default:t(()=>[p(h(a.status==="0"?"正常":"停用"),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"createTime",label:"创建时间",width:"180"},{default:t(({row:a})=>[p(h(te(a.createTime)),1)]),_:1}),l(i,{label:"操作",width:"180",fixed:"right"},{default:t(({row:a})=>[N((_(),k(c,{type:"primary",link:"",icon:"Edit",onClick:pe=>Z(a),disabled:a.roleKey==="admin"},{default:t(()=>[...e[15]||(e[15]=[p(" 编辑 ",-1)])]),_:1},8,["onClick","disabled"])),[[R,"system:role:edit"]]),N((_(),k(c,{type:"danger",link:"",icon:"Delete",onClick:pe=>le(a),disabled:a.roleKey==="admin"},{default:t(()=>[...e[16]||(e[16]=[p(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])),[[R,"system:role:remove"]])]),_:1})]),_:1},8,["data"])),[[ue,x.value]]),l(oe,{"current-page":d.pageNum,"onUpdate:currentPage":e[2]||(e[2]=a=>d.pageNum=a),"page-size":d.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>d.pageSize=a),"page-sizes":[10,20,50,100],total:U.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px","justify-content":"flex-end"},onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"]),l(re,{modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=a=>f.value=a),title:C.value,width:"700px","destroy-on-close":""},{footer:t(()=>[l(c,{onClick:e[10]||(e[10]=a=>f.value=!1)},{default:t(()=>[...e[19]||(e[19]=[p("取消",-1)])]),_:1}),l(c,{type:"primary",loading:I.value,onClick:ee},{default:t(()=>[...e[20]||(e[20]=[p("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(g,{ref_key:"formRef",ref:B,model:o,rules:F,"label-width":"100px"},{default:t(()=>[l(K,{gutter:20},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(r,{modelValue:o.roleName,"onUpdate:modelValue":e[4]||(e[4]=a=>o.roleName=a),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(u,{label:"权限字符",prop:"roleKey"},{default:t(()=>[l(r,{modelValue:o.roleKey,"onUpdate:modelValue":e[5]||(e[5]=a=>o.roleKey=a),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(K,{gutter:20},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"排序",prop:"sort"},{default:t(()=>[l(ne,{modelValue:o.sort,"onUpdate:modelValue":e[6]||(e[6]=a=>o.sort=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(u,{label:"状态",prop:"status"},{default:t(()=>[l(se,{modelValue:o.status,"onUpdate:modelValue":e[7]||(e[7]=a=>o.status=a)},{default:t(()=>[l(q,{value:"0"},{default:t(()=>[...e[17]||(e[17]=[p("正常",-1)])]),_:1}),l(q,{value:"1"},{default:t(()=>[...e[18]||(e[18]=[p("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(K,{gutter:20},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"数据范围",prop:"dataScope"},{default:t(()=>[l(de,{modelValue:o.dataScope,"onUpdate:modelValue":e[8]||(e[8]=a=>o.dataScope=a),placeholder:"请选择",style:{width:"100%"}},{default:t(()=>[l(v,{label:"全部数据",value:"1"}),l(v,{label:"自定义数据",value:"2"}),l(v,{label:"本部门及以下",value:"3"}),l(v,{label:"仅本部门",value:"4"}),l(v,{label:"仅本人",value:"5"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(u,{label:"菜单权限",prop:"menuIds"},{default:t(()=>[S("div",Ne,[l(P,{ref_key:"menuTreeRef",ref:V,data:T.value,props:{label:"menuName",children:"children"},"node-key":"menuId","show-checkbox":"","default-expand-all":""},null,8,["data"])])]),_:1}),o.dataScope==="2"?(_(),k(u,{key:0,label:"数据权限",prop:"deptIds"},{default:t(()=>[S("div",Se,[l(P,{ref_key:"deptTreeRef",ref:w,data:E.value,props:{label:"deptName",children:"children"},"node-key":"deptId","show-checkbox":"","default-expand-all":""},null,8,["data"])])]),_:1})):ke("",!0),l(u,{label:"备注",prop:"remark"},{default:t(()=>[l(r,{modelValue:o.remark,"onUpdate:modelValue":e[9]||(e[9]=a=>o.remark=a),type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{he as default};
