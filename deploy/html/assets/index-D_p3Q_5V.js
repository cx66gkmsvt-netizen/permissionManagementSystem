import{v as C,x as ue,d as p,f as j,c as se,b as e,y as re,w as t,r,z as ie,m as me,o as M,a as P,h as i,t as h,s as pe,E as D}from"./index-BDk5bd72.js";import{l as ce}from"./dept-BHWUl4rM.js";function fe(c){return C({url:"/system/cc",method:"get",params:c})}function ge(c){return C({url:`/system/cc/${c}`,method:"get"})}function be(c){return C({url:"/system/cc",method:"post",data:c})}function _e(c,V){return C({url:`/system/cc/${c}`,method:"put",data:V})}function ve(c){return C({url:`/system/cc/${c}`,method:"delete"})}const ye={class:"page-card"},he={__name:"index",setup(c){const V=p(!1),z=p([]),S=p(0),_=p(!1),N=p(""),x=p(!1),U=p([]),v=p([]),I=p([]),w=p([]),A=p(),s=j({pageNum:1,pageSize:10,name:"",mobile:"",teamId:null,squadId:null,status:""}),o=j({id:null,name:"",nickName:"",mobile:"",wechat:"",cno:"",cloudAccount:"",teamId:null,squadId:null,status:"0"}),Q={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],teamId:[{required:!0,message:"请选择所属军团",trigger:"change"}]};ue(()=>{R(),y()});const y=async()=>{V.value=!0;try{const u=await fe(s);z.value=u.data.rows||[],S.value=u.data.total||0}finally{V.value=!1}},R=async()=>{const u=await ce();U.value=u.data||[],v.value=U.value},T=u=>{if(!u)return"-";const l=n=>{for(const d of n){if(d.deptId===u)return d.deptName;if(d.children){const g=l(d.children);if(g)return g}}return null};return l(U.value)||u},F=u=>{if(s.squadId=null,I.value=[],u){const l=k(v.value,u);l&&l.children&&(I.value=l.children)}},G=u=>{if(o.squadId=null,w.value=[],u){const l=k(v.value,u);l&&l.children&&(w.value=l.children)}},k=(u,l)=>{for(const n of u){if(n.deptId===l)return n;if(n.children){const d=k(n.children,l);if(d)return d}}return null},$=()=>{s.pageNum=1,y()},H=()=>{s.name="",s.mobile="",s.teamId=null,s.squadId=null,s.status="",I.value=[],$()},E=()=>{o.id=null,o.name="",o.nickName="",o.mobile="",o.wechat="",o.cno="",o.cloudAccount="",o.teamId=null,o.squadId=null,o.status="0",w.value=[]},J=()=>{E(),N.value="新增CC",_.value=!0},K=async u=>{E();const n=(await ge(u.id)).data;if(Object.assign(o,{id:n.id,name:n.name,nickName:n.nickName,mobile:n.mobile,wechat:n.wechat,cno:n.cno,cloudAccount:n.cloudAccount,teamId:n.teamId,squadId:n.squadId,status:n.status}),n.teamId){const d=k(v.value,n.teamId);d&&d.children&&(w.value=d.children)}N.value="编辑CC",_.value=!0},W=async()=>{await A.value.validate(),x.value=!0;try{o.id?(await _e(o.id,o),D.success("更新成功")):(await be(o),D.success("创建成功")),_.value=!1,y()}finally{x.value=!1}},X=u=>{pe.confirm("确定删除该CC吗？","提示",{type:"warning"}).then(async()=>{await ve(u.id),D.success("删除成功"),y()})},Y=u=>u?new Date(u).toLocaleString("zh-CN"):"-";return(u,l)=>{const n=r("el-input"),d=r("el-form-item"),g=r("el-tree-select"),B=r("el-option"),Z=r("el-select"),b=r("el-button"),L=r("el-form"),m=r("el-table-column"),ee=r("el-tag"),le=r("el-table"),te=r("el-pagination"),f=r("el-col"),q=r("el-row"),O=r("el-radio"),ae=r("el-radio-group"),oe=r("el-dialog"),ne=ie("loading");return M(),se("div",ye,[e(L,{inline:!0,model:s,class:"table-actions"},{default:t(()=>[P("div",null,[e(d,{label:"姓名"},{default:t(()=>[e(n,{modelValue:s.name,"onUpdate:modelValue":l[0]||(l[0]=a=>s.name=a),placeholder:"请输入姓名",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(d,{label:"手机号"},{default:t(()=>[e(n,{modelValue:s.mobile,"onUpdate:modelValue":l[1]||(l[1]=a=>s.mobile=a),placeholder:"请输入手机号",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(d,{label:"军团"},{default:t(()=>[e(g,{modelValue:s.teamId,"onUpdate:modelValue":l[2]||(l[2]=a=>s.teamId=a),data:v.value,props:{label:"deptName",value:"deptId",children:"children"},placeholder:"请选择军团","check-strictly":"",clearable:"",style:{width:"150px"},onChange:F},null,8,["modelValue","data"])]),_:1}),e(d,{label:"战队"},{default:t(()=>[e(g,{modelValue:s.squadId,"onUpdate:modelValue":l[3]||(l[3]=a=>s.squadId=a),data:I.value,props:{label:"deptName",value:"deptId",children:"children"},placeholder:"请选择战队","check-strictly":"",clearable:"",style:{width:"150px"}},null,8,["modelValue","data"])]),_:1}),e(d,{label:"状态"},{default:t(()=>[e(Z,{modelValue:s.status,"onUpdate:modelValue":l[4]||(l[4]=a=>s.status=a),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:t(()=>[e(B,{label:"正常",value:"0"}),e(B,{label:"停用",value:"1"})]),_:1},8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[e(b,{type:"primary",icon:"Search",onClick:$},{default:t(()=>[...l[18]||(l[18]=[i("搜索",-1)])]),_:1}),e(b,{icon:"Refresh",onClick:H},{default:t(()=>[...l[19]||(l[19]=[i("重置",-1)])]),_:1})]),_:1})]),P("div",null,[e(b,{type:"primary",icon:"Plus",onClick:J},{default:t(()=>[...l[20]||(l[20]=[i("新增CC",-1)])]),_:1})])]),_:1},8,["model"]),re((M(),me(le,{data:z.value,border:""},{default:t(()=>[e(m,{type:"index",label:"序号",width:"60",align:"center"}),e(m,{prop:"name",label:"姓名",width:"100"}),e(m,{prop:"nickName",label:"昵称",width:"100"}),e(m,{prop:"mobile",label:"手机号",width:"120"}),e(m,{prop:"wechat",label:"微信号",width:"120"}),e(m,{prop:"cno",label:"座席号",width:"100"}),e(m,{prop:"cloudAccount",label:"云客账号",width:"120"}),e(m,{label:"所属军团",width:"120"},{default:t(({row:a})=>[i(h(T(a.teamId)),1)]),_:1}),e(m,{label:"所属战队",width:"120"},{default:t(({row:a})=>[i(h(T(a.squadId)),1)]),_:1}),e(m,{prop:"balance",label:"个人资金",width:"120"},{default:t(({row:a})=>[i(" ¥ "+h(a.balance),1)]),_:1}),e(m,{prop:"status",label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[e(ee,{type:a.status==="0"?"success":"danger"},{default:t(()=>[i(h(a.status==="0"?"正常":"停用"),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"createTime",label:"创建时间",width:"160"},{default:t(({row:a})=>[i(h(Y(a.createTime)),1)]),_:1}),e(m,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[e(b,{type:"primary",link:"",icon:"Edit",onClick:de=>K(a)},{default:t(()=>[...l[21]||(l[21]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(b,{type:"danger",link:"",icon:"Delete",onClick:de=>X(a)},{default:t(()=>[...l[22]||(l[22]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,V.value]]),e(te,{"current-page":s.pageNum,"onUpdate:currentPage":l[5]||(l[5]=a=>s.pageNum=a),"page-size":s.pageSize,"onUpdate:pageSize":l[6]||(l[6]=a=>s.pageSize=a),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px","justify-content":"flex-end"},onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"]),e(oe,{modelValue:_.value,"onUpdate:modelValue":l[17]||(l[17]=a=>_.value=a),title:N.value,width:"650px","destroy-on-close":""},{footer:t(()=>[e(b,{onClick:l[16]||(l[16]=a=>_.value=!1)},{default:t(()=>[...l[25]||(l[25]=[i("取消",-1)])]),_:1}),e(b,{type:"primary",loading:x.value,onClick:W},{default:t(()=>[...l[26]||(l[26]=[i("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(L,{ref_key:"formRef",ref:A,model:o,rules:Q,"label-width":"100px"},{default:t(()=>[e(q,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"姓名",prop:"name"},{default:t(()=>[e(n,{modelValue:o.name,"onUpdate:modelValue":l[7]||(l[7]=a=>o.name=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"昵称",prop:"nickName"},{default:t(()=>[e(n,{modelValue:o.nickName,"onUpdate:modelValue":l[8]||(l[8]=a=>o.nickName=a),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"手机号",prop:"mobile"},{default:t(()=>[e(n,{modelValue:o.mobile,"onUpdate:modelValue":l[9]||(l[9]=a=>o.mobile=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"微信号",prop:"wechat"},{default:t(()=>[e(n,{modelValue:o.wechat,"onUpdate:modelValue":l[10]||(l[10]=a=>o.wechat=a),placeholder:"请输入微信号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"座席号",prop:"cno"},{default:t(()=>[e(n,{modelValue:o.cno,"onUpdate:modelValue":l[11]||(l[11]=a=>o.cno=a),placeholder:"请输入座席号"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"云客账号",prop:"cloudAccount"},{default:t(()=>[e(n,{modelValue:o.cloudAccount,"onUpdate:modelValue":l[12]||(l[12]=a=>o.cloudAccount=a),placeholder:"请输入云客账号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"所属军团",prop:"teamId"},{default:t(()=>[e(g,{modelValue:o.teamId,"onUpdate:modelValue":l[13]||(l[13]=a=>o.teamId=a),data:v.value,props:{label:"deptName",value:"deptId",children:"children"},placeholder:"请选择军团","check-strictly":"",style:{width:"100%"},onChange:G},null,8,["modelValue","data"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"所属战队",prop:"squadId"},{default:t(()=>[e(g,{modelValue:o.squadId,"onUpdate:modelValue":l[14]||(l[14]=a=>o.squadId=a),data:w.value,props:{label:"deptName",value:"deptId",children:"children"},placeholder:"请选择战队","check-strictly":"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),e(d,{label:"状态",prop:"status"},{default:t(()=>[e(ae,{modelValue:o.status,"onUpdate:modelValue":l[15]||(l[15]=a=>o.status=a)},{default:t(()=>[e(O,{value:"0"},{default:t(()=>[...l[23]||(l[23]=[i("正常",-1)])]),_:1}),e(O,{value:"1"},{default:t(()=>[...l[24]||(l[24]=[i("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{he as default};
