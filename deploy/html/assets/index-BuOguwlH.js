import{v as E,_ as J,u as K,x as O,f as q,c as B,b as e,w as o,r as n,o as V,a as c,t as f,l as i,F as Q,k as W,m as X,h as p,d as _,E as D}from"./index-BDk5bd72.js";function Y(w){return E({url:"/system/profile",method:"put",data:w})}function Z(w){return E({url:"/system/profile/password",method:"put",data:w})}const $={class:"profile-container"},ee={class:"page-card user-card"},oe={class:"user-avatar"},ae={class:"user-role"},le={class:"page-card"},se={__name:"index",setup(w){const r=K(),x=_("info"),v=_(!1),y=_(!1),h=_(),k=_(),d=q({nickName:"",phone:"",email:""}),t=q({oldPassword:"",newPassword:"",confirmPassword:""}),L={nickName:[{required:!0,message:"请输入昵称",trigger:"blur"}]},S={oldPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度6-20位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(g,a,b)=>{a!==t.newPassword?b(new Error("两次输入的密码不一致")):b()},trigger:"blur"}]};O(()=>{r.userInfo&&(d.nickName=r.userInfo.nickName||"",d.phone=r.userInfo.phone||"",d.email=r.userInfo.email||"")});const z=async()=>{await h.value.validate(),v.value=!0;try{await Y(d),D.success("修改成功"),await r.fetchUserInfo()}finally{v.value=!1}},M=async()=>{await k.value.validate(),y.value=!0;try{await Z({oldPassword:t.oldPassword,newPassword:t.newPassword}),D.success("密码修改成功"),t.oldPassword="",t.newPassword="",t.confirmPassword=""}finally{y.value=!1}},T=g=>g?new Date(g).toLocaleString("zh-CN"):"-";return(g,a)=>{const b=n("el-avatar"),j=n("el-tag"),P=n("el-descriptions-item"),A=n("el-descriptions"),I=n("el-col"),m=n("el-input"),u=n("el-form-item"),N=n("el-button"),U=n("el-form"),F=n("el-tab-pane"),G=n("el-tabs"),H=n("el-row");return V(),B("div",$,[e(H,{gutter:20},{default:o(()=>[e(I,{span:8},{default:o(()=>{var l,C;return[c("div",ee,[c("div",oe,[e(b,{size:100,icon:"UserFilled"})]),c("h3",null,f(((l=i(r).userInfo)==null?void 0:l.nickName)||((C=i(r).userInfo)==null?void 0:C.userName)),1),c("p",ae,[(V(!0),B(Q,null,W(i(r).roles,s=>(V(),X(j,{key:s,type:"primary",style:{margin:"2px"}},{default:o(()=>[p(f(s),1)]),_:2},1024))),128))]),e(A,{column:1,border:"",style:{"margin-top":"20px"}},{default:o(()=>[e(P,{label:"用户名"},{default:o(()=>{var s;return[p(f((s=i(r).userInfo)==null?void 0:s.userName),1)]}),_:1}),e(P,{label:"所属部门"},{default:o(()=>{var s,R;return[p(f(((R=(s=i(r).userInfo)==null?void 0:s.dept)==null?void 0:R.deptName)||"未分配"),1)]}),_:1}),e(P,{label:"登录时间"},{default:o(()=>{var s;return[p(f(T((s=i(r).userInfo)==null?void 0:s.loginDate)),1)]}),_:1}),e(P,{label:"登录IP"},{default:o(()=>{var s;return[p(f(((s=i(r).userInfo)==null?void 0:s.loginIp)||"-"),1)]}),_:1})]),_:1})])]}),_:1}),e(I,{span:16},{default:o(()=>[c("div",le,[e(G,{modelValue:x.value,"onUpdate:modelValue":a[6]||(a[6]=l=>x.value=l)},{default:o(()=>[e(F,{label:"基本信息",name:"info"},{default:o(()=>[e(U,{ref_key:"infoFormRef",ref:h,model:d,rules:L,"label-width":"100px",style:{"max-width":"500px"}},{default:o(()=>[e(u,{label:"昵称",prop:"nickName"},{default:o(()=>[e(m,{modelValue:d.nickName,"onUpdate:modelValue":a[0]||(a[0]=l=>d.nickName=l),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),e(u,{label:"手机号",prop:"phone"},{default:o(()=>[e(m,{modelValue:d.phone,"onUpdate:modelValue":a[1]||(a[1]=l=>d.phone=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(u,{label:"邮箱",prop:"email"},{default:o(()=>[e(m,{modelValue:d.email,"onUpdate:modelValue":a[2]||(a[2]=l=>d.email=l),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),e(u,null,{default:o(()=>[e(N,{type:"primary",loading:v.value,onClick:z},{default:o(()=>[...a[7]||(a[7]=[p("保存修改",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(F,{label:"修改密码",name:"password"},{default:o(()=>[e(U,{ref_key:"pwdFormRef",ref:k,model:t,rules:S,"label-width":"100px",style:{"max-width":"500px"}},{default:o(()=>[e(u,{label:"旧密码",prop:"oldPassword"},{default:o(()=>[e(m,{modelValue:t.oldPassword,"onUpdate:modelValue":a[3]||(a[3]=l=>t.oldPassword=l),type:"password",placeholder:"请输入旧密码","show-password":""},null,8,["modelValue"])]),_:1}),e(u,{label:"新密码",prop:"newPassword"},{default:o(()=>[e(m,{modelValue:t.newPassword,"onUpdate:modelValue":a[4]||(a[4]=l=>t.newPassword=l),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),e(u,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[e(m,{modelValue:t.confirmPassword,"onUpdate:modelValue":a[5]||(a[5]=l=>t.confirmPassword=l),type:"password",placeholder:"请确认新密码","show-password":""},null,8,["modelValue"])]),_:1}),e(u,null,{default:o(()=>[e(N,{type:"primary",loading:y.value,onClick:M},{default:o(()=>[...a[8]||(a[8]=[p("修改密码",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})])}}},ne=J(se,[["__scopeId","data-v-256b9780"]]);export{ne as default};
