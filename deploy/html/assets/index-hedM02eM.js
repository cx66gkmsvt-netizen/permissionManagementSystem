import{v as k,x as ce,d as m,f as S,c as P,b as e,y as C,w as t,r as n,z as H,m as v,o as g,a as J,h as p,F as W,k as X,t as q,p as ye,s as we,E as z}from"./index-BDk5bd72.js";import{l as _e}from"./role-DKO9rRKm.js";import{l as ve}from"./dept-BHWUl4rM.js";function be(i){return k({url:"/system/user",method:"get",params:i})}function Ve(i){return k({url:`/system/user/${i}`,method:"get"})}function ke(i){return k({url:"/system/user",method:"post",data:i})}function Ne(i,y){return k({url:`/system/user/${i}`,method:"put",data:y})}function Ie(i){return k({url:`/system/user/${i}`,method:"delete"})}function Ue(i,y){return k({url:`/system/user/${i}/resetPwd`,method:"put",data:{password:y}})}const xe={class:"page-card"},De={__name:"index",setup(i){const y=m(!1),E=m([]),F=m(0),b=m(!1),h=m(""),D=m(!1),N=m(!1),B=m([]),L=m([]),T=m(),j=m(),r=S({pageNum:1,pageSize:10,userName:"",phone:"",status:""}),s=S({userId:null,userName:"",nickName:"",password:"",phone:"",email:"",deptId:null,status:"0",roleIds:[]}),w=S({userId:null,password:""}),Y={userName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],nickName:[{required:!0,message:"请输入昵称",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},Z={password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度6-20位",trigger:"blur"}]};ce(()=>{V(),ee(),le()});const V=async()=>{y.value=!0;try{const u=await be(r);E.value=u.data.rows||[],F.value=u.data.total||0}finally{y.value=!1}},ee=async()=>{const u=await ve();B.value=u.data||[]},le=async()=>{const u=await _e();L.value=u.data||[]},M=()=>{r.pageNum=1,V()},te=()=>{r.userName="",r.phone="",r.status="",M()},O=()=>{s.userId=null,s.userName="",s.nickName="",s.password="",s.phone="",s.email="",s.deptId=null,s.status="0",s.roleIds=[]},ae=()=>{O(),h.value="新增用户",b.value=!0},se=async u=>{var d;O();const o=(await Ve(u.userId)).data;Object.assign(s,{userId:o.userId,userName:o.userName,nickName:o.nickName,phone:o.phone,email:o.email,deptId:o.deptId,status:o.status,roleIds:((d=o.roles)==null?void 0:d.map(I=>I.roleId))||[]}),h.value="编辑用户",b.value=!0},oe=async()=>{await T.value.validate(),D.value=!0;try{s.userId?(await Ne(s.userId,s),z.success("更新成功")):(await ke(s),z.success("创建成功")),b.value=!1,V()}finally{D.value=!1}},re=u=>{we.confirm("确定删除该用户吗？","提示",{type:"warning"}).then(async()=>{await Ie(u.userId),z.success("删除成功"),V()})},ue=u=>{w.userId=u.userId,w.password="",N.value=!0},de=async()=>{await j.value.validate(),await Ue(w.userId,w.password),z.success("重置成功"),N.value=!1},ne=u=>u?new Date(u).toLocaleString("zh-CN"):"-";return(u,l)=>{const o=n("el-input"),d=n("el-form-item"),I=n("el-option"),A=n("el-select"),f=n("el-button"),R=n("el-form"),c=n("el-table-column"),Q=n("el-tag"),pe=n("el-table"),ie=n("el-pagination"),_=n("el-col"),x=n("el-row"),me=n("el-tree-select"),K=n("el-radio"),fe=n("el-radio-group"),G=n("el-dialog"),$=H("permission"),ge=H("loading");return g(),P("div",xe,[e(R,{inline:!0,model:r,class:"table-actions"},{default:t(()=>[J("div",null,[e(d,{label:"用户名"},{default:t(()=>[e(o,{modelValue:r.userName,"onUpdate:modelValue":l[0]||(l[0]=a=>r.userName=a),placeholder:"请输入用户名",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(d,{label:"手机号"},{default:t(()=>[e(o,{modelValue:r.phone,"onUpdate:modelValue":l[1]||(l[1]=a=>r.phone=a),placeholder:"请输入手机号",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(d,{label:"状态"},{default:t(()=>[e(A,{modelValue:r.status,"onUpdate:modelValue":l[2]||(l[2]=a=>r.status=a),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:t(()=>[e(I,{label:"正常",value:"0"}),e(I,{label:"停用",value:"1"})]),_:1},8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[e(f,{type:"primary",icon:"Search",onClick:M},{default:t(()=>[...l[18]||(l[18]=[p("搜索",-1)])]),_:1}),e(f,{icon:"Refresh",onClick:te},{default:t(()=>[...l[19]||(l[19]=[p("重置",-1)])]),_:1})]),_:1})]),J("div",null,[C((g(),v(f,{type:"primary",icon:"Plus",onClick:ae},{default:t(()=>[...l[20]||(l[20]=[p("新增",-1)])]),_:1})),[[$,"system:user:add"]])])]),_:1},8,["model"]),C((g(),v(pe,{data:E.value,border:""},{default:t(()=>[e(c,{type:"index",label:"序号",width:"60",align:"center"}),e(c,{prop:"userName",label:"用户名",width:"120"}),e(c,{prop:"nickName",label:"昵称",width:"120"}),e(c,{prop:"phone",label:"手机号",width:"120"}),e(c,{prop:"dept.deptName",label:"部门",width:"150"}),e(c,{label:"角色",width:"200"},{default:t(({row:a})=>[(g(!0),P(W,null,X(a.roles,U=>(g(),v(Q,{key:U.roleId,type:"primary",size:"small",style:{margin:"2px"}},{default:t(()=>[p(q(U.roleName),1)]),_:2},1024))),128))]),_:1}),e(c,{prop:"status",label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[e(Q,{type:a.status==="0"?"success":"danger"},{default:t(()=>[p(q(a.status==="0"?"正常":"停用"),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"createTime",label:"创建时间",width:"180"},{default:t(({row:a})=>[p(q(ne(a.createTime)),1)]),_:1}),e(c,{label:"操作",width:"220",fixed:"right"},{default:t(({row:a})=>[C((g(),v(f,{type:"primary",link:"",icon:"Edit",onClick:U=>se(a)},{default:t(()=>[...l[21]||(l[21]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[$,"system:user:edit"]]),C((g(),v(f,{type:"danger",link:"",icon:"Delete",onClick:U=>re(a)},{default:t(()=>[...l[22]||(l[22]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])),[[$,"system:user:remove"]]),e(f,{type:"warning",link:"",icon:"Key",onClick:U=>ue(a)},{default:t(()=>[...l[23]||(l[23]=[p(" 重置密码 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,y.value]]),e(ie,{"current-page":r.pageNum,"onUpdate:currentPage":l[3]||(l[3]=a=>r.pageNum=a),"page-size":r.pageSize,"onUpdate:pageSize":l[4]||(l[4]=a=>r.pageSize=a),"page-sizes":[10,20,50,100],total:F.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px","justify-content":"flex-end"},onSizeChange:V,onCurrentChange:V},null,8,["current-page","page-size","total"]),e(G,{modelValue:b.value,"onUpdate:modelValue":l[14]||(l[14]=a=>b.value=a),title:h.value,width:"600px","destroy-on-close":""},{footer:t(()=>[e(f,{onClick:l[13]||(l[13]=a=>b.value=!1)},{default:t(()=>[...l[26]||(l[26]=[p("取消",-1)])]),_:1}),e(f,{type:"primary",loading:D.value,onClick:oe},{default:t(()=>[...l[27]||(l[27]=[p("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(R,{ref_key:"formRef",ref:T,model:s,rules:Y,"label-width":"80px"},{default:t(()=>[e(x,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(d,{label:"用户名",prop:"userName"},{default:t(()=>[e(o,{modelValue:s.userName,"onUpdate:modelValue":l[5]||(l[5]=a=>s.userName=a),disabled:!!s.userId,placeholder:"请输入用户名"},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(d,{label:"昵称",prop:"nickName"},{default:t(()=>[e(o,{modelValue:s.nickName,"onUpdate:modelValue":l[6]||(l[6]=a=>s.nickName=a),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s.userId?ye("",!0):(g(),v(x,{key:0,gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(d,{label:"密码",prop:"password"},{default:t(()=>[e(o,{modelValue:s.password,"onUpdate:modelValue":l[7]||(l[7]=a=>s.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})),e(x,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(d,{label:"手机号",prop:"phone"},{default:t(()=>[e(o,{modelValue:s.phone,"onUpdate:modelValue":l[8]||(l[8]=a=>s.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(d,{label:"邮箱",prop:"email"},{default:t(()=>[e(o,{modelValue:s.email,"onUpdate:modelValue":l[9]||(l[9]=a=>s.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(d,{label:"部门",prop:"deptId"},{default:t(()=>[e(me,{modelValue:s.deptId,"onUpdate:modelValue":l[10]||(l[10]=a=>s.deptId=a),data:B.value,props:{label:"deptName",value:"deptId",children:"children"},placeholder:"请选择部门","check-strictly":"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(d,{label:"状态",prop:"status"},{default:t(()=>[e(fe,{modelValue:s.status,"onUpdate:modelValue":l[11]||(l[11]=a=>s.status=a)},{default:t(()=>[e(K,{value:"0"},{default:t(()=>[...l[24]||(l[24]=[p("正常",-1)])]),_:1}),e(K,{value:"1"},{default:t(()=>[...l[25]||(l[25]=[p("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{label:"角色",prop:"roleIds"},{default:t(()=>[e(A,{modelValue:s.roleIds,"onUpdate:modelValue":l[12]||(l[12]=a=>s.roleIds=a),multiple:"",placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[(g(!0),P(W,null,X(L.value,a=>(g(),v(I,{key:a.roleId,label:a.roleName,value:a.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(G,{modelValue:N.value,"onUpdate:modelValue":l[17]||(l[17]=a=>N.value=a),title:"重置密码",width:"400px"},{footer:t(()=>[e(f,{onClick:l[16]||(l[16]=a=>N.value=!1)},{default:t(()=>[...l[28]||(l[28]=[p("取消",-1)])]),_:1}),e(f,{type:"primary",onClick:de},{default:t(()=>[...l[29]||(l[29]=[p("确定",-1)])]),_:1})]),default:t(()=>[e(R,{ref_key:"pwdFormRef",ref:j,model:w,rules:Z,"label-width":"80px"},{default:t(()=>[e(d,{label:"新密码",prop:"password"},{default:t(()=>[e(o,{modelValue:w.password,"onUpdate:modelValue":l[15]||(l[15]=a=>w.password=a),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{De as default};
